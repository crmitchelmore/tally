# Migration Progress Status

Last Updated: 2026-01-09

## Current status (authoritative summary)

- ✅ **Project 1 (Next.js Web)**: complete and deployed.
- ⏳ **Project 6 (Marketing + /app relocation)**: live in production; remaining is manual end-to-end auth verification in prod.
- ⏳ **Project 2 (Shared API)**: implemented; completion checklist still pending (needs authenticated curl verification).
- ⏳ **CI/CD**: GitHub Actions runs checks on push; Vercel deploy via GH Actions is configured; Convex deploy via GH Actions is configured but currently **skips** until `CONVEX_DEPLOY_KEY` is set.

> Note: sections below may include historical “blocked/not started” notes that are now superseded by the summary above.

## PROJECT 1: Next.js + Vercel Migration

### Task 1.1: Project Initialization ✅ COMPLETE
- [x] Created Next.js 16 project with App Router in `tally-web/`
- [x] Installed all core dependencies (framer-motion, recharts, date-fns, etc.)
- [x] Configured Tailwind CSS v4 with custom theme
- [x] Configured path aliases (@/*)
- [x] TypeScript compiles without errors
- [x] ESLint passes without errors

### Task 1.2: shadcn/ui Component Setup ✅ COMPLETE
- [x] Initialized shadcn/ui with new-york style
- [x] Installed 46 UI components
- [x] Copied custom tally-specific CSS styles
- [x] Created test page at `/test-components`

### Task 1.3: Convex Database Setup ⏳ PARTIAL
- [x] Installed Convex package
- [x] Created database schema with 4 tables:
  - users (with clerk sync)
  - challenges (with all fields)
  - entries (with sets, feeling, notes)
  - followedChallenges
- [x] Created all Convex functions:
  - users.ts (getOrCreate, getByClerkId, get)
  - challenges.ts (list, listActive, listPublic, get, create, update, archive, remove)
  - entries.ts (listByChallenge, listByUser, listByUserDate, listByDateRange, create, update, remove)
  - followedChallenges.ts (listByUser, isFollowing, follow, unfollow, getFollowerCount)
- [x] Created Convex provider
- [ ] **BLOCKED**: Need to run `npx convex dev` with account to generate real types

### Task 1.4: Authentication with Clerk ⏳ PARTIAL
- [x] Installed @clerk/nextjs
- [x] Created .env.local.example with all required variables
- [x] Set up ClerkProvider in layout.tsx
- [x] Created proxy.ts (was middleware.ts) with route protection
- [x] Created sign-in page at `/sign-in`
- [x] Created sign-up page at `/sign-up`
- [x] Created auth.config.ts for Convex/Clerk integration
- [x] Created useStoreUser and useCurrentUser hooks
- [ ] **BLOCKED**: Need real Clerk credentials for testing

### Task 1.5: Component Migration ✅ COMPLETE
- [x] Created lib/utils.ts with cn() and formatting functions
- [x] Created lib/stats.ts with all calculation functions
- [x] Created lib/constants.ts with colors, icons, presets
- [x] Created lib/adapters.ts with Convex-to-app type converters
- [x] Created lib/exportImport.ts with data backup/restore utilities
- [x] Created lib/weeklySummary.ts with summary generation
- [x] Created types/index.ts with application types
- [x] Migrated TallyMarks.tsx
- [x] Migrated CircularProgress.tsx
- [x] Migrated HeatmapCalendar.tsx
- [x] Migrated ChallengeCard.tsx
- [x] Migrated AddEntrySheet.tsx
- [x] Migrated AddEntryDetailSheet.tsx
- [x] Migrated EditEntryDialog.tsx
- [x] Migrated CreateChallengeDialog.tsx
- [x] Migrated ChallengeSettingsDialog.tsx
- [x] Migrated DayEntriesDialog.tsx
- [x] Migrated OverallStats.tsx
- [x] Migrated PersonalRecords.tsx
- [x] Migrated SetsRepsAnalysis.tsx
- [x] Migrated SentimentAnalysis.tsx
- [x] Migrated ExportImportDialog.tsx
- [x] Migrated WeeklySummaryDialog.tsx
- [x] Migrated UserProfile.tsx
- [x] Migrated ChallengeDetailView.tsx
- [x] Migrated FollowedChallengeCard.tsx
- [x] Migrated LeaderboardView.tsx
- [x] Migrated PublicChallengesView.tsx
- [x] Created component index.ts for exports
- [x] Created main page.tsx with dashboard layout
- [x] TypeScript compilation passes

### Task 1.6: Real-time Features ⏳ NOT STARTED
- [ ] Enable optimistic updates
- [ ] Verify real-time sync
- [ ] Add loading states with Skeletons

### Task 1.7: Deployment to Vercel ⏳ NOT STARTED
- [ ] Deploy Convex to production
- [ ] Configure Vercel project
- [ ] Set environment variables
- [ ] Configure Clerk for production
- [ ] Verify production deployment

---

## Blocking Issues

### 1. Convex Project Setup
The Convex types need to be generated by running `npx convex dev` with an account. Currently using placeholder types.

**To resolve:**
```bash
cd tally-web
npx convex dev
# Choose: Start without account OR login
# This will generate convex/_generated/* files
```

### 2. Clerk Credentials
Build fails with placeholder Clerk key. Need real credentials.

**To resolve:**
1. Create Clerk account at https://clerk.com
2. Create new application
3. Copy NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY and CLERK_SECRET_KEY
4. Update .env.local

---

## Files Created

```
tally-web/
├── convex/
│   ├── schema.ts
│   ├── users.ts
│   ├── challenges.ts
│   ├── entries.ts
│   ├── followedChallenges.ts
│   ├── auth.config.ts
│   └── _generated/ (placeholder)
├── src/
│   ├── app/
│   │   ├── layout.tsx (with Clerk & Convex providers)
│   │   ├── page.tsx (main dashboard)
│   │   ├── globals.css (with tally styles)
│   │   ├── sign-in/[[...sign-in]]/page.tsx
│   │   ├── sign-up/[[...sign-up]]/page.tsx
│   │   └── test-components/page.tsx
│   ├── components/
│   │   ├── ui/ (46 shadcn components)
│   │   └── tally/
│   │       ├── index.ts (component exports)
│   │       ├── TallyMarks.tsx
│   │       ├── CircularProgress.tsx
│   │       ├── HeatmapCalendar.tsx
│   │       ├── ChallengeCard.tsx
│   │       ├── ChallengeDetailView.tsx
│   │       ├── AddEntrySheet.tsx
│   │       ├── AddEntryDetailSheet.tsx
│   │       ├── EditEntryDialog.tsx
│   │       ├── CreateChallengeDialog.tsx
│   │       ├── ChallengeSettingsDialog.tsx
│   │       ├── DayEntriesDialog.tsx
│   │       ├── OverallStats.tsx
│   │       ├── PersonalRecords.tsx
│   │       ├── SetsRepsAnalysis.tsx
│   │       ├── SentimentAnalysis.tsx
│   │       ├── ExportImportDialog.tsx
│   │       ├── WeeklySummaryDialog.tsx
│   │       ├── UserProfile.tsx
│   │       ├── FollowedChallengeCard.tsx
│   │       ├── LeaderboardView.tsx
│   │       └── PublicChallengesView.tsx
│   ├── hooks/
│   │   ├── use-mobile.ts (from shadcn)
│   │   └── use-store-user.ts
│   ├── lib/
│   │   ├── utils.ts
│   │   ├── stats.ts
│   │   ├── constants.ts
│   │   ├── adapters.ts (Convex-to-app type converters)
│   │   ├── exportImport.ts
│   │   └── weeklySummary.ts
│   ├── providers/
│   │   └── convex-provider.tsx
│   ├── types/
│   │   └── index.ts
│   └── proxy.ts (auth middleware)
├── .env.local
├── .env.local.example
├── README.md
└── eslint.config.mjs
```

## PROJECT 6: Marketing Landing Page + App Relocation

- [x] Chosen strategy: landing on `/`, app on `/app`
- [x] Landing page implemented at `tally-web/src/app/page.tsx`
- [x] App moved to `tally-web/src/app/app/page.tsx`
- [x] Auth redirects updated to land on `/app`
- [x] Public iOS/Android pages added (`/ios`, `/android`)
- [ ] Manual auth verification (blocked on real Clerk credentials)

## Next Steps

1. Set up Convex account and run `npx convex dev`
2. Set up Clerk account and add credentials to .env.local
3. Verify auth flow end-to-end (sign up, sign in, sign out)
4. Deploy to Vercel

