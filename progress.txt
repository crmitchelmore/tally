# progress.txt
# Running log for PRD-driven work.
#
# Use one line per notable change or verification. When something needs external input,
# write: "BLOCKED: ..." and move on.

## 2026-01-20: CD landing page + /app shell (feature-cd.md)
- Created tally-web Next.js 14 project with Bun (App Router, TypeScript, Tailwind CSS v3)
- Landing page (/) with Tally branding, tally mark visual, CTAs
- App shell (/app) with sign-in placeholder
- Fixed hashFiles() workflow condition (evaluates before checkout, always empty)
- Fixed Tailwind v3 compatibility (v4 syntax incompatible with Next.js 14)
- Deploy workflow #15 completed successfully
- Production URL https://tally-tracker.app/ returns HTTP 200
- PRD item "CD: deploy hello-world landing page" marked passes=true
2026-01-20: Added minimal landing + /app shells in tally-web, aligned deploy-production workflow to always run, and verified bun run build succeeds. BLOCKED: production Vercel deploy + smoke check require external Vercel/GitHub Actions execution and secrets.

## 2026-01-20: Web theme & app structure (feature-theme-structure.md)
- Design tokens: OKLCH colors, typography, motion, spacing in src/lib/design-tokens.ts
- CSS custom properties for light/dark theming in globals.css
- TallyMark component (src/components/ui/tally-mark.tsx) with fractal completion system:
  - 1-4: vertical strokes
  - 5: 5-gate (4 strokes + diagonal slash)
  - 6-24: multiple 5-gates
  - 25+: simplified representations for large counts (100-blocks, 1000-rows, etc.)
  - Animation support with prefers-reduced-motion fallback
- App shell components: AppHeader, AppNav, SyncIndicator, ThemeToggle, UserMenu
- App layout with persistent header and responsive navigation
- Interactive TallyMark demo on /app page for visual verification
- useTheme and useReducedMotion hooks for accessibility
- Build and lint pass (bun run build, bun run lint)
- PRD item "Web theme & app structure" passes=true

## 2026-01-20: Web auth + user provisioning (feature-auth.md)
- Installed @clerk/nextjs (v6.36.8)
- Created middleware.ts with clerkMiddleware:
  - Public routes: /, /sign-in, /sign-up, /__clerk, /api/v1/public, /api/v1/auth/user
  - API routes return 401 JSON for unauthenticated requests
  - Pages redirect to /sign-in with redirect_url param
  - Env guard for missing NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY (build-time safety)
- Created /sign-in/[[...sign-in]]/page.tsx with Clerk SignIn component + Tally styling
- Created /sign-up/[[...sign-up]]/page.tsx with Clerk SignUp component + Tally styling
- Created /api/v1/auth/user POST/GET endpoint for user provisioning (in-memory store)
- Updated root layout.tsx to conditionally wrap with ClerkProvider
- Updated /app layout to use real Clerk user via useUser/useClerk hooks
- Updated /app page to show auth-aware content:
  - Signed-out: CTA to sign up/sign in with TallyMark display
  - Signed-in: Welcome message with user's first name
- Copied .env to tally-web/.env.local with secrets
- Added img.clerk.com to next.config.mjs remotePatterns
- Build and lint pass (bun run build, bun run lint)
- PRD item "Web auth + user provisioning" passes=true
