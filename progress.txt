# progress.txt
# Running log for PRD-driven work.
#
# Use one line per notable change or verification. When something needs external input,
# write: "BLOCKED: ..." and move on.

## 2026-01-20: CD landing page + /app shell (feature-cd.md)
- Created tally-web Next.js 14 project with Bun (App Router, TypeScript, Tailwind CSS v3)
- Landing page (/) with Tally branding, tally mark visual, CTAs
- App shell (/app) with sign-in placeholder
- Fixed hashFiles() workflow condition (evaluates before checkout, always empty)
- Fixed Tailwind v3 compatibility (v4 syntax incompatible with Next.js 14)
- Deploy workflow #15 completed successfully
- Production URL https://tally-tracker.app/ returns HTTP 200
- PRD item "CD: deploy hello-world landing page" marked passes=true
2026-01-20: Added minimal landing + /app shells in tally-web, aligned deploy-production workflow to always run, and verified bun run build succeeds. BLOCKED: production Vercel deploy + smoke check require external Vercel/GitHub Actions execution and secrets.

## 2026-01-20: Web theme & app structure (feature-theme-structure.md)
- Design tokens: OKLCH colors, typography, motion, spacing in src/lib/design-tokens.ts
- CSS custom properties for light/dark theming in globals.css
- TallyMark component (src/components/ui/tally-mark.tsx) with fractal completion system:
  - 1-4: vertical strokes
  - 5: 5-gate (4 strokes + diagonal slash)
  - 6-24: multiple 5-gates
  - 25+: simplified representations for large counts (100-blocks, 1000-rows, etc.)
  - Animation support with prefers-reduced-motion fallback
- App shell components: AppHeader, AppNav, SyncIndicator, ThemeToggle, UserMenu
- App layout with persistent header and responsive navigation
- Interactive TallyMark demo on /app page for visual verification
- useTheme and useReducedMotion hooks for accessibility
- Build and lint pass (bun run build, bun run lint)
- PRD item "Web theme & app structure" passes=true

## 2026-01-20: Web auth + user provisioning (feature-auth.md)
- Installed @clerk/nextjs (v6.36.8)
- Created middleware.ts with clerkMiddleware:
  - Public routes: /, /sign-in, /sign-up, /__clerk, /api/v1/public, /api/v1/auth/user
  - API routes return 401 JSON for unauthenticated requests
  - Pages redirect to /sign-in with redirect_url param
  - Env guard for missing NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY (build-time safety)
- Created /sign-in/[[...sign-in]]/page.tsx with Clerk SignIn component + Tally styling
- Created /sign-up/[[...sign-up]]/page.tsx with Clerk SignUp component + Tally styling
- Created /api/v1/auth/user POST/GET endpoint for user provisioning (in-memory store)
- Updated root layout.tsx to conditionally wrap with ClerkProvider
- Updated /app layout to use real Clerk user via useUser/useClerk hooks
- Updated /app page to show auth-aware content:
  - Signed-out: CTA to sign up/sign in with TallyMark display
  - Signed-in: Welcome message with user's first name
- Copied .env to tally-web/.env.local with secrets
- Added img.clerk.com to next.config.mjs remotePatterns
- Build and lint pass (bun run build, bun run lint)
- PRD item "Web auth + user provisioning" passes=true

## 2026-01-20: Web API contract (feature-api-contract.md)
- Created _lib helpers for API routes:
  - types.ts: User, Challenge, Entry, Follow, Stats, API request/response types
  - auth.ts: requireAuth() helper for protected routes
  - store.ts: In-memory CRUD operations + stats calculations
  - validate.ts: Request validation for challenges, entries, import data
  - response.ts: Consistent JSON response helpers (jsonOk, jsonCreated, jsonBadRequest, etc.)
- Refactored /api/v1/auth/user to use shared helpers
- Implemented challenge endpoints:
  - GET/POST /api/v1/challenges (list, create with timeframe calculation)
  - GET/PATCH/DELETE /api/v1/challenges/[id] (with ownership + public access checks)
  - GET /api/v1/challenges/[id]/stats (pace, streaks, averages)
- Implemented entry endpoints:
  - GET/POST /api/v1/entries (with challenge ownership validation)
  - GET/PATCH/DELETE /api/v1/entries/[id] (future date blocked)
- Implemented community endpoints:
  - GET /api/v1/public/challenges (with totalReps, progress, followerCount, owner aggregation)
  - GET /api/v1/followed (followed challenges with aggregated data)
  - POST/DELETE /api/v1/follow (follow/unfollow with validation)
- Implemented data portability:
  - GET /api/v1/data (export JSON with version)
  - POST /api/v1/data (import with replace-all semantics)
  - DELETE /api/v1/data (clear all user data)
- Implemented dashboard stats:
  - GET /api/v1/stats (totalMarks, today, bestStreak, paceStatus, personal records)
- Build and lint pass (bun run build, bun run lint)
- PRD item "Web API contract" passes=true

## 2026-01-20: Web challenges feature (feature-challenges.md)
- Created challenges component folder (src/components/challenges/):
  - challenge-card.tsx: Dashboard card with progress ring, TallyMark preview, pace status
  - create-challenge-dialog.tsx: Modal dialog for creating challenges with name, target, timeframe (year/month/custom), color picker, icon selector, public toggle
  - challenge-list.tsx: Grid view with loading/empty/error states and create button
  - activity-heatmap.tsx: Yearly activity heatmap with intensity scaling and day-click drilldown
- Created /app/challenges/[id]/page.tsx detail view:
  - Header with stats grid (progress, remaining, days left, per-day needed)
  - Pace callout with ahead/on-pace/behind status
  - TallyMark visualization of total progress
  - ActivityHeatmap component for yearly view
  - Streaks & records section
  - Settings panel with archive/unarchive and delete options
- Updated /app/page.tsx to use ChallengeList with API integration:
  - Fetches challenges with stats on mount
  - Create challenge wired to POST /api/v1/challenges
  - Loading, empty, error states with clear feedback
- Accessibility: focus-visible states, ARIA labels, reduced-motion support
- Build and lint pass (bun run build, bun run lint)
- PRD item "Web challenges feature" passes=true

## 2026-01-20: Web entries feature (feature-entries.md)
- Created entries component folder (src/components/entries/):
  - add-entry-dialog.tsx: Modal for adding entries with large tap targets, count +/- buttons, date picker (no future dates), feeling selector, note field, TallyMark preview
  - entry-list.tsx: List of entries grouped by date with edit/delete actions
  - day-drilldown.tsx: Modal for per-day view from heatmap click
  - edit-entry-dialog.tsx: Modal for editing existing entries with delete option
- Updated /app/challenges/[id]/page.tsx with entry management:
  - "Add Entry" button in header
  - Recent entries list with edit/delete
  - Heatmap day click opens DayDrilldown
  - Entry CRUD wired to API endpoints
- Added dialog animations to globals.css:
  - animate-dialog-in with reduced-motion fallback
  - animate-stroke-draw for tally ink effect
- Fast entry UX: large tap targets, immediate feedback, instant for reduced-motion
- No confetti/emoji - ink-stroke success feedback only
- Build and lint pass (bun run build, bun run lint)
- PRD item "Web entries feature" passes=true

## 2026-01-20: Web stats feature (feature-stats.md)
- Created stats component folder (src/components/stats/):
  - dashboard-highlights.tsx: Total marks, today count, best streak, overall pace status
  - personal-records.tsx: Best single day, longest streak, highest daily avg, most active days, biggest entry
  - weekly-summary.tsx: Modal with week navigation, daily breakdown bars, by-challenge breakdown
- Updated /app/page.tsx to include stats:
  - Dashboard highlights above challenges list
  - Personal records section
  - Weekly Summary button + modal with week navigation
  - Fetch stats/entries on mount, refresh after changes
- All stats computed correctly via /api/v1/stats endpoint
- Activity heatmap updates after entry changes (existing from challenges feature)
- Weekly summary matches selected week with navigation
- Build and lint pass (bun run build, bun run lint)
- PRD item "Web stats feature" passes=true

## 2026-01-20: Web data portability (feature-data-portability.md)
- Created data component folder (src/components/data/):
  - export-data.tsx: Export JSON and CSV formats with download trigger
  - import-data.tsx: File picker with replace-all confirmation dialog
  - clear-data.tsx: Dangerous action with "delete" confirmation text
  - data-management-section.tsx: Modal dialog containing all three actions
- Added DataManagementSection to /app page header (beside Weekly Summary)
- API endpoints already exist from feature-api-contract.md:
  - GET /api/v1/data exports all user challenges and entries
  - POST /api/v1/data imports with replace-all semantics + ID remapping
  - DELETE /api/v1/data clears all user data
- CSV export includes # CHALLENGES and # ENTRIES sections with headers
- Import validates JSON structure before clearing existing data
- Clear requires typing "delete" to confirm
- Build and lint pass (bun run build, bun run lint)
- PRD item "Web data portability" passes=true

## 2026-01-20: Web community feature (feature-community.md)
- Created community component folder (src/components/community/):
  - public-challenge-card.tsx: Card for public challenges with follow/unfollow button, optimistic UI updates, progress bar, follower count, owner info
  - public-challenges-list.tsx: List with debounced search, loading/empty/error states
  - followed-challenges-section.tsx: Dashboard section showing followed challenges in horizontal scroll, with unfollow on hover
  - community-section.tsx: Collapsible section to browse public challenges
  - index.ts: Barrel exports
- Updated /app/page.tsx to include:
  - FollowedChallengesSection between PersonalRecords and ChallengeList
  - CommunitySection at bottom for discovering public challenges
- API endpoints already exist with real server-side aggregation from feature-api-contract.md:
  - GET /api/v1/public/challenges: real totalReps, progress, followerCount, owner aggregation
  - POST /api/v1/follow: follow validation (public only, not own challenge)
  - DELETE /api/v1/follow: unfollow
  - GET /api/v1/followed: followed challenges with aggregated data
- Optimistic UI updates for follow/unfollow with error revert
- Private challenges never appear in public list (filtered in getPublicChallenges)
- Accessibility: focus-visible states, ARIA labels for buttons
- Build and lint pass (bun run build, bun run lint)
- PRD item "Web community" passes=true

## 2026-01-20: Landing page hero micro-demo (feature-hero-micro-demo.md)
- Created landing component folder (src/components/landing/):
  - hero-micro-demo.tsx: Interactive challenge card demo with +1 button
  - index.ts: Barrel exports
- HeroMicroDemo component features:
  - Interactive +1 button increments count (up to 25)
  - Tally strokes animate with pencil-like ink draw effect (200ms)
  - 5th stroke is the signature red diagonal slash
  - Strokes grouped into five-gates (4 vertical + 1 diagonal)
  - Progress bar updates with smooth transition
  - Reset button to restart demo
  - Completion message at 25 marks
- Animation styles in globals.css:
  - demo-stroke-draw: scaleY animation with bounce easing for vertical strokes
  - demo-slash-draw: diagonal slash animation with same easing
  - Reduced-motion fallback: instant appearance, no animation
- Performance considerations:
  - Lightweight client component (no heavy charting libraries)
  - ~1.5 kB addition to First Load JS
  - Hydrates after render (standard Next.js behavior)
- Accessibility:
  - ARIA labels on buttons and demo region
  - aria-live for tally count updates
  - Focus-visible states on all interactive elements
  - Minimum 44Ã—48px tap targets on +1 button
- Updated landing page (/) to include HeroMicroDemo between copy and CTAs
- Build and lint pass (bun run build, bun run lint)
- PRD item "Landing page hero micro-demo" passes=true
