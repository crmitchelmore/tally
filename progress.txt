# progress.txt
# Running log for PRD-driven work.
#
# Use one line per notable change or verification. When something needs external input,
# write: "BLOCKED: ..." and move on.

## 2026-01-20: CD landing page + /app shell (feature-cd.md)
- Created tally-web Next.js 14 project with Bun (App Router, TypeScript, Tailwind CSS v3)
- Landing page (/) with Tally branding, tally mark visual, CTAs
- App shell (/app) with sign-in placeholder
- Fixed hashFiles() workflow condition (evaluates before checkout, always empty)
- Fixed Tailwind v3 compatibility (v4 syntax incompatible with Next.js 14)
- Deploy workflow #15 completed successfully
- Production URL https://tally-tracker.app/ returns HTTP 200
- PRD item "CD: deploy hello-world landing page" marked passes=true
2026-01-20: Added minimal landing + /app shells in tally-web, aligned deploy-production workflow to always run, and verified bun run build succeeds. BLOCKED: production Vercel deploy + smoke check require external Vercel/GitHub Actions execution and secrets.

## 2026-01-20: Web theme & app structure (feature-theme-structure.md)
- Design tokens: OKLCH colors, typography, motion, spacing in src/lib/design-tokens.ts
- CSS custom properties for light/dark theming in globals.css
- TallyMark component (src/components/ui/tally-mark.tsx) with fractal completion system:
  - 1-4: vertical strokes
  - 5: 5-gate (4 strokes + diagonal slash)
  - 6-24: multiple 5-gates
  - 25+: simplified representations for large counts (100-blocks, 1000-rows, etc.)
  - Animation support with prefers-reduced-motion fallback
- App shell components: AppHeader, AppNav, SyncIndicator, ThemeToggle, UserMenu
- App layout with persistent header and responsive navigation
- Interactive TallyMark demo on /app page for visual verification
- useTheme and useReducedMotion hooks for accessibility
- Build and lint pass (bun run build, bun run lint)
- PRD item "Web theme & app structure" passes=true

## 2026-01-20: Web auth + user provisioning (feature-auth.md)
- Installed @clerk/nextjs (v6.36.8)
- Created middleware.ts with clerkMiddleware:
  - Public routes: /, /sign-in, /sign-up, /__clerk, /api/v1/public, /api/v1/auth/user
  - API routes return 401 JSON for unauthenticated requests
  - Pages redirect to /sign-in with redirect_url param
  - Env guard for missing NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY (build-time safety)
- Created /sign-in/[[...sign-in]]/page.tsx with Clerk SignIn component + Tally styling
- Created /sign-up/[[...sign-up]]/page.tsx with Clerk SignUp component + Tally styling
- Created /api/v1/auth/user POST/GET endpoint for user provisioning (in-memory store)
- Updated root layout.tsx to conditionally wrap with ClerkProvider
- Updated /app layout to use real Clerk user via useUser/useClerk hooks
- Updated /app page to show auth-aware content:
  - Signed-out: CTA to sign up/sign in with TallyMark display
  - Signed-in: Welcome message with user's first name
- Copied .env to tally-web/.env.local with secrets
- Added img.clerk.com to next.config.mjs remotePatterns
- Build and lint pass (bun run build, bun run lint)
- PRD item "Web auth + user provisioning" passes=true

## 2026-01-20: Web API contract (feature-api-contract.md)
- Created _lib helpers for API routes:
  - types.ts: User, Challenge, Entry, Follow, Stats, API request/response types
  - auth.ts: requireAuth() helper for protected routes
  - store.ts: In-memory CRUD operations + stats calculations
  - validate.ts: Request validation for challenges, entries, import data
  - response.ts: Consistent JSON response helpers (jsonOk, jsonCreated, jsonBadRequest, etc.)
- Refactored /api/v1/auth/user to use shared helpers
- Implemented challenge endpoints:
  - GET/POST /api/v1/challenges (list, create with timeframe calculation)
  - GET/PATCH/DELETE /api/v1/challenges/[id] (with ownership + public access checks)
  - GET /api/v1/challenges/[id]/stats (pace, streaks, averages)
- Implemented entry endpoints:
  - GET/POST /api/v1/entries (with challenge ownership validation)
  - GET/PATCH/DELETE /api/v1/entries/[id] (future date blocked)
- Implemented community endpoints:
  - GET /api/v1/public/challenges (with totalReps, progress, followerCount, owner aggregation)
  - GET /api/v1/followed (followed challenges with aggregated data)
  - POST/DELETE /api/v1/follow (follow/unfollow with validation)
- Implemented data portability:
  - GET /api/v1/data (export JSON with version)
  - POST /api/v1/data (import with replace-all semantics)
  - DELETE /api/v1/data (clear all user data)
- Implemented dashboard stats:
  - GET /api/v1/stats (totalMarks, today, bestStreak, paceStatus, personal records)
- Build and lint pass (bun run build, bun run lint)
- PRD item "Web API contract" passes=true

## 2026-01-20: Web challenges feature (feature-challenges.md)
- Created challenges component folder (src/components/challenges/):
  - challenge-card.tsx: Dashboard card with progress ring, TallyMark preview, pace status
  - create-challenge-dialog.tsx: Modal dialog for creating challenges with name, target, timeframe (year/month/custom), color picker, icon selector, public toggle
  - challenge-list.tsx: Grid view with loading/empty/error states and create button
  - activity-heatmap.tsx: Yearly activity heatmap with intensity scaling and day-click drilldown
- Created /app/challenges/[id]/page.tsx detail view:
  - Header with stats grid (progress, remaining, days left, per-day needed)
  - Pace callout with ahead/on-pace/behind status
  - TallyMark visualization of total progress
  - ActivityHeatmap component for yearly view
  - Streaks & records section
  - Settings panel with archive/unarchive and delete options
- Updated /app/page.tsx to use ChallengeList with API integration:
  - Fetches challenges with stats on mount
  - Create challenge wired to POST /api/v1/challenges
  - Loading, empty, error states with clear feedback
- Accessibility: focus-visible states, ARIA labels, reduced-motion support
- Build and lint pass (bun run build, bun run lint)
- PRD item "Web challenges feature" passes=true

## 2026-01-20: Web entries feature (feature-entries.md)
- Created entries component folder (src/components/entries/):
  - add-entry-dialog.tsx: Modal for adding entries with large tap targets, count +/- buttons, date picker (no future dates), feeling selector, note field, TallyMark preview
  - entry-list.tsx: List of entries grouped by date with edit/delete actions
  - day-drilldown.tsx: Modal for per-day view from heatmap click
  - edit-entry-dialog.tsx: Modal for editing existing entries with delete option
- Updated /app/challenges/[id]/page.tsx with entry management:
  - "Add Entry" button in header
  - Recent entries list with edit/delete
  - Heatmap day click opens DayDrilldown
  - Entry CRUD wired to API endpoints
- Added dialog animations to globals.css:
  - animate-dialog-in with reduced-motion fallback
  - animate-stroke-draw for tally ink effect
- Fast entry UX: large tap targets, immediate feedback, instant for reduced-motion
- No confetti/emoji - ink-stroke success feedback only
- Build and lint pass (bun run build, bun run lint)
- PRD item "Web entries feature" passes=true

## 2026-01-20: Web stats feature (feature-stats.md)
- Created stats component folder (src/components/stats/):
  - dashboard-highlights.tsx: Total marks, today count, best streak, overall pace status
  - personal-records.tsx: Best single day, longest streak, highest daily avg, most active days, biggest entry
  - weekly-summary.tsx: Modal with week navigation, daily breakdown bars, by-challenge breakdown
- Updated /app/page.tsx to include stats:
  - Dashboard highlights above challenges list
  - Personal records section
  - Weekly Summary button + modal with week navigation
  - Fetch stats/entries on mount, refresh after changes
- All stats computed correctly via /api/v1/stats endpoint
- Activity heatmap updates after entry changes (existing from challenges feature)
- Weekly summary matches selected week with navigation
- Build and lint pass (bun run build, bun run lint)
- PRD item "Web stats feature" passes=true
